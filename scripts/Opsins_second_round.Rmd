---
title: "opsins"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r,echo=FALSE, message=FALSE, warning=FALSE}
opsins_d_second <- read.csv('/home/alena/Documents/IB/project_opsins/PIA_second_round.txt')
opsins_DF <- data.frame(opsins_d_second)
```


Было два запуска PIA:  c параметрами pValue E-10 и E-20. 

PIA нашел
 `r sum(opsins_d_second$E20) `возможнных опсина при поиске c pValue =  E-20. При этом в `r length(which(opsins_d_second$E20 == 0)) ` транскриптомах не обнаружилось ни одного опсина! при поиске c pValue = E-10 нашлось `r sum(opsins_d_second$E10) `
 возможных опсина, а количество транскриптомов, где ничего не нашлось снизилось до `r length(which(opsins_d_second$E10 == 0))`
 
 
 
 См. данные в таблице 
 
```{r, echo=FALSE, message=FALSE, warning=FALSE}

library(DT) 
datatable(opsins_DF)
library(ggplot2) 
library(plotly) 
library(scales) 
```
В большинстве случаев нашлось 2-3 опсина. См. рисунки ниже


```{r, echo=FALSE, message=FALSE, warning=FALSE}


plot1 = ggplot(opsins_DF, aes(x=opsins_DF$E10)) + geom_histogram(stat="count") + scale_x_continuous(breaks= pretty_breaks()) + geom_bar(width = 1) + theme(axis.text.x = element_text(size=12), axis.text.y = element_text(size=12))

ggplotly(plot1 + labs( title = 'Количество найденных опсинов при PIA pValue=E-10', subtitle = 'E-10', y = ' ', x = 'количество опсинов '))

plot2 = ggplot(opsins_DF, aes(x=opsins_DF$E20)) + geom_histogram(stat="count") + scale_x_continuous(breaks= pretty_breaks()) + geom_bar(width = 1) + theme(axis.text.x = element_text(size=12), axis.text.y = element_text(size=12))
ggplotly(plot2 + labs( title = 'Количество найденных опсинов при PIA pValue=E-20 ', subtitle = 'E-20', y = ' ', x = 'количество опсинов '))
```

А вот так эти две гистограммы вылядят вместе:

```{r,echo=FALSE, message=FALSE, warning=FALSE}

opsins_only_counts <- read.csv2('/Users/neku/Documents/workspace/opsins/second_round/counts_second.csv')
opsins_only_counts$pValue <- factor(opsins_only_counts$pValue)
ggplot(opsins_only_counts,aes(x = opsins_only_counts$count, fill =pValue)) + geom_histogram(alpha = 0.9) + scale_x_continuous(breaks= pretty_breaks()) + labs( title = 'Количество найденных опсинов при разных pValue PIA', y = ' counts', x = 'количество найденных кандидатов в опсины ') + geom_bar(width = 0.8 )
```


Далее мы будем рассматривать результаты работы PIA c pValue10^-10


Количество missing BUSCOs отражает качество сборки, если их много - качество сборки плохое. 
Посмотрим, как зависит количество определенных PIA опсинов от качеcтва транскриптома  (количества ненайденных BUSCOs)

```{r, echo=FALSE, message=FALSE, warning=FALSE}

#exponential.model <- lm((opsins_DF$E10) ~ log(opsins_DF$Missing.BUSCOs))
#summary(exponential.model)

plot3 = ggplot(opsins_DF, aes(x=opsins_DF$Missing.BUSCOs, y = opsins_DF$E10)) + geom_point() + scale_y_continuous(breaks= pretty_breaks()) 
ggplotly(plot3 + labs( title = 'Количество  опсинов E-10 PIA от Missing BUSCOs', subtitle = 'E-10', y = 'количество опсинов', x = ' % Неопределенных BUSCOs'))


```

Видно, что больше всего опсинов идентифицируется при значениях Missing Buscos равных 15 - 25 %, то есть в хорошо собранных транскриптомах.




